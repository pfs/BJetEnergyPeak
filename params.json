{"name":"Bjetenergypeak","tagline":"","body":"# BJetEnergyPeak\r\n\r\n## Installation\r\n\r\nTo install the code do\r\n```\r\ncmsrel CMSSW_7_4_14\r\ncd CMSSW_7_4_14/src\r\ncmsenv\r\ngit clone git@github.com:pfs/BJetEnergyPeak.git UserCode/BJetEnergyPeak\r\nscram b\r\ncd UserCode/BJetEnergyPeak\r\n```\r\n\r\n## Prepare ntuples for local analysis\r\n\r\nThis step should be done only once and it's only commissioned to be run at CERN in lxplus. \r\nIt skims the information needed for the analysis in simplified ntuples.\r\nThe starting point are the BTV performance ntuples. Further details on how to produce them can be found in \r\nhttps://twiki.cern.ch/twiki/bin/view/CMS/BTagCommissioning2015. Before skimming three steps must be done:\r\n\r\n* Determine the pileup weights: the output is a ROOT file: data/puweights.root. Run the following script\r\n```\r\npython scripts/runPileupEstimation.py \r\n```\r\n* Determine the normalization weights for all the samples available. The output is a pickle file: data/genweights.pck. Run the following script\r\n```\r\npython scripts/produceNormalizationCache.py -i /store/group/phys_btag/performance/TTbar/2015_25ns/8622ee3\r\n```\r\n* Project the expected b-tagging efficiency for the TTbar sample. The output is a pickle file: btagefficiencies. Run the following script\r\n```\r\npython scripts/projectExpectedBtagEff.py -i /store/group/phys_btag/performance/TTbar/2015_25ns/8622ee3/MC13TeV_TTJets\r\n```\r\nThe files above will be stored by default in github, but if a reprocessing of the original ntuples occurs,\r\nthey need to be run again. For the pileup estimation one needs to use the original json file (check with BTV experts).\r\nWith the files updated you're now ready to skim the info needed for the ntuples. You can run the following command\r\n```\r\npython scripts/skimBJetEnergyPeakNtuples.py -i /store/group/phys_btag/performance/TTbar/2015_25ns/8622ee3 -o analysis -n 8\r\n```\r\n\r\n## Ntuple content\r\n\r\n| Variable | Type | Comments |\r\n| :------------ | :------------ | :------------ | \r\n| Run | I | run number |\r\n| Evt | I | event number |\r\n| LumiBlock | I | lumi section |\r\n| nPV | I | no. primary vertices |\r\n| nPUtrue | F | no. pileup generated |\r\n| PUWeights | [3]/F | pileup weights: nominal/down/up |\r\n| LepSelEffWeights | [3]/F | lepton selection scale factors : nominal/down/up |\r\n| TrigWord | I | each bit is a trigger fired |\r\n| nLepton | I | no. selected leptons |\r\n| Lepton_{pt,eta,phi} | []/F | Lepton kinematics |\r\n| Lepton_{id,gid,ch} | []/I | Lepton id, matched id at gen. level and charge |\r\n| MET_{pt,phi} | F | Missing transverse energy pT and phi |\r\n| nGenWeight | I | no. generator level weights |\r\n| GenWeights | []/I | generator level weights |\r\n| nJet | I | no. jets |\r\n| Jet_{pt,eta,phi,mass} | []/F | jet kinematics |\r\n| Jet_flavour | I | jet flavour at gen. level |\r\n| Jet_genpt | F | jet pt at gen. level |\r\n| Jet_CombIVF  | F| CSV discriminator |\r\n| Jet_uncs | [][29]/F | Jet energy resolution and scale uncertainties |\r\n\r\n\r\n## Producing and plotting a simple b-jet energy peak distribution\r\n\r\nThe following is an example of how to run locally over the skimmed ntuples to produce the b-jet energy peak.\r\nTo run the event selection and basic filling of histograms using a pre-defined list of samples and cross sections one can use the following script \r\n```\r\npython scripts/runBJetEnergyPeak.py -i analysis -j data/samples_Run2015_25ns.json -o analysis/plots -n 8\r\n```\r\nThe results are stored in ROOT files and can be plotted together and compared to data using\r\n```\r\npython scripts/plotter.py -i analysis/ -j data/samples_Run2015_25ns.json  -l 2444.\r\n```\r\nUnder analysis/plots you'll find the files with the plots and also a file called plotter.root containing the histograms with the distributions\r\nnormalized by integrated luminosity.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}